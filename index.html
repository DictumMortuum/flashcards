<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>Flashcards</title>
  <meta name="description" content="Italian flashcards">
  <meta name="author" content="Dimitris Raviolos">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue@2x.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.2.1/css/drawer.min.css">
  <!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    * {
      padding: 0;
      margin: 0;
      font-family: 'Lato', sans-serif;
    }

    html {
      height: 100%;
    }

    body {
      width: 100%;
      background-color: #272A33;
    }

    .flashcard {
      width: 100%;
      height: 100%;
      background-color: #f5f5f5;
      color: #181818;
      transition: all 0.5s ease;
      resize: both;
      overflow: auto;
      font-size: 1.4em;
      word-spacing: 0.9em;
    }

    body, .front, .back {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .flashcard.hover {
      background-color: #181818;
      color: #f5f5f5;
    }

    .flashcard .front {
      display: flex;
    }

    .flashcard .back {
      display: none;
    }

    .flashcard.hover .front {
      display: none;
    }

    .flashcard.hover .back {
      display: flex;
    }

    .drawer-hamburger-icon,
    .drawer-hamburger-icon:before,
    .drawer-hamburger-icon:after {
      height: 4px;
      background-color: #2489C5;
    }

    .drawer-menu {
      padding: 5%;
    }
  </style>
</head>
<body class="drawer drawer--left">
  <header role="banner">
    <button type="button" class="drawer-toggle drawer-hamburger">
      <span class="sr-only">toggle navigation</span>
      <span class="drawer-hamburger-icon"></span>
    </button>
    <nav class="drawer-nav" role="navigation">
      <ul class="drawer-menu">
        <li>
          <input type="checkbox" id="verb" checked>
          <label for="verb">Ρήματα</label>
        </li>
        <li>
          <input type="checkbox" id="plural" checked>
          <label for="plural">Πληθυντικοί</label>
        </li>
        <li>
          <input type="checkbox" id="female" checked>
          <label for="female">Θηλυκά</label>
        </li>
        <li>
          <input type="checkbox" id="preposition" checked>
          <label for="preposition">Προθέσεις</label>
        </li>
      </ul>
    </nav>
  </header>
  <div class="center flashcard"></div>
  <script id="template" type="x-tmpl-mustache">
    <p class="front">{{{front}}}</p>
    <p class="back">{{{back}}}</p>
  </script>
  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/icheck.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iScroll/5.1.3/iscroll.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.2.1/js/drawer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.4.3/tabletop.min.js"></script>
  <script>
    const template = $('#template').html()
    const card = $('.flashcard')
    Mustache.parse(template)

    function shuffle(array) {
      var m = array.length, t, i;
      // While there remain elements to shuffle…
      while (m) {
        // Pick a remaining element…
        i = Math.floor(Math.random() * m--);
        // And swap it with the current element.
        t = array[m];
        array[m] = array[i];
        array[i] = t;
      }
      return array;
    }

    function filter(data) {
      var clone = []

      if($('#verb').is(":checked")) {
        Array.prototype.push.apply(clone, data.verb.elements)
      }

      if($('#female').is(":checked")) {
        Array.prototype.push.apply(clone, data.female.elements)
      }

      if($('#plural').is(":checked")) {
        Array.prototype.push.apply(clone, data.plural.elements)
      }

      if($('#preposition').is(":checked")) {
        Array.prototype.push.apply(clone, data.preposition.elements)
      }

      return clone
    }

    function pick(data) {
      var question = shuffle(data).slice(0,1)
      var rendered = Mustache.render(template, question[0])
      $(card).html(rendered)
    }

    function show(data) {
      if(card.is('.hover')) {
        card.removeClass('hover')
        pick(data)
      } else {
        card.addClass('hover')
      }
    }

    $(document).ready(function(){
      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue'
      });
      $('.drawer').drawer();
      Tabletop.init({
        'key': '1Uudy-LplOzKGQTFSqVOdOm8aklOqTNVbWj9JpWcsbjs',
        'callback': function(data, tabletop) {
          var subset = filter(data)
          pick(subset)
          $('input').on('ifToggled', function() {
            subset = filter(data)
          })
          $('.flashcard').click(function() {
            show(subset)
          })
        },
        'simplesheet': true
      })
    });
  </script>
</body>
</html>
