<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>Italian flashcards</title>
  <meta name="description" content="Italian flashcards">
  <meta name="author" content="Dimitris Raviolos">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&amp;subset=greek" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/skins/square/blue@2x.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.2.1/css/drawer.min.css">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
  <style>
    body, html {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      height: 100%
    }

    .loader {
      border: thick solid #fff;
      border-top: thick solid #2489C5;
      border-radius: 50%;
      width: 240px;
      height: 240px;
      animation: spin 1.5s linear infinite
    }

    @keyframes spin {
      0% { transform: rotate(0deg) }
      100% { transform: rotate(360deg) }
    }

    .flashcard {
      width: 90%;
      padding: 0 5% 0 5%;
      height: inherit;
      background-color: #f5f5f5;
      color: #181818;
      transition: all 0.5s ease;
      resize: both;
      overflow: auto;
      font-size: 1.4em;
      word-spacing: 0.5em;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column
    }

    .visible {
      background-color: #181818;
      color: #f5f5f5
    }

    .front, .visible .back { display: flex }
    .back, .visible .front { display: none }

    .drawer-hamburger-icon,
    .drawer-hamburger-icon:before,
    .drawer-hamburger-icon:after {
      height: 4px;
      background-color: #2489C5
    }

    .drawer-menu { padding: 5% }
    .drawer-menu li { padding: 0.5% }
  </style>
</head>
<body class="drawer drawer--left">
  <header role="banner">
    <button type="button" class="drawer-toggle drawer-hamburger">
      <span class="sr-only">toggle navigation</span>
      <span class="drawer-hamburger-icon"></span>
    </button>
    <nav class="drawer-nav" role="navigation">
      <ul class="drawer-menu">
        <li>
          <input type="checkbox" id="verb" checked>
          <label for="verb">Ρήματα</label>
        </li>
        <li>
          <input type="checkbox" id="plural" checked>
          <label for="plural">Πληθυντικοί</label>
        </li>
        <li>
          <input type="checkbox" id="female" checked>
          <label for="female">Θηλυκά</label>
        </li>
        <li>
          <input type="checkbox" id="preposition" checked>
          <label for="preposition">Προθέσεις</label>
        </li>
        <li>
          <input type="checkbox" id="participio" checked>
          <label for="preposition">Mετοχές Αορίστου</label>
        </li>
        <li>
          <input type="checkbox" id="futuro_semplice" checked>
          <label for="preposition">Απλός Μέλλοντας</label>
        </li>
      </ul>
    </nav>
  </header>
  <div class="flashcard">
    <div class="loader"></div>
  </div>
  <script id="template" type="x-tmpl-mustache">
    <p>{{{description}}}</p>
    <p class="front">{{{front}}}</p>
    <p class="back">{{{back}}}</p>
  </script>
  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iCheck/1.0.2/icheck.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iScroll/5.1.3/iscroll.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.2.1/js/drawer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.4.3/tabletop.min.js"></script>
  <script>
    const template = $('#template').html()
    const card = $('.flashcard')
    Mustache.parse(template)

    function shuffle_questions(array) {
      var m = array.length, t, i;

      while (m) {
        i = Math.floor(Math.random() * m--);
        t = array[m];
        array[m] = array[i];
        array[i] = t;
      }

      return array;
    }

    function filter_categories(data) {
      var clone = []

      Object.keys(data).forEach(input => {
        if($('#' + input).is(":checked")) {
          Array.prototype.push.apply(clone, data[input].elements)
        }
      })

      pick_question(clone)
      return clone
    }

    function pick_question(data) {
      var question = shuffle_questions(data).slice(0,1)
      var rendered = Mustache.render(template, question[0])
      $(card).html(rendered)
      card.removeClass('visible')
    }

    function flip_question(data) {
      if(card.is('.visible')) {
        pick_question(data)
      } else {
        card.addClass('visible')
      }
    }

    function flashcard_init(data, tabletop) {
      var subset = filter_categories(data)

      $('input').on('ifToggled', function() {
        subset = filter_categories(data)
      })

      $('.flashcard').click(function() {
        flip_question(subset)
      })

      $(document).keydown(function(e) {
        switch(e.which) {
          case 37: // left
          case 38: // up
          case 39: // right
          case 40: // bottom
            flip_question(subset)
          break;
          default:
            return
        }
        e.preventDefault()
      })
    }

    $(function() {
      $('input').iCheck({
        'checkboxClass': 'icheckbox_square-blue',
        'radioClass': 'iradio_square-blue'
      })

      $('.drawer').drawer()

      Tabletop.init({
        'key': '1Uudy-LplOzKGQTFSqVOdOm8aklOqTNVbWj9JpWcsbjs',
        'callback': flashcard_init,
        'simplesheet': true
      })
    })
  </script>
</body>
</html>
